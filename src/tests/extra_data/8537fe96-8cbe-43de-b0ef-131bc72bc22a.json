{
    "description": "Windows machines should have the specified Group Policy settings in the category 'Windows Components' for basic authentication, unencrypted traffic, Microsoft accounts, telemetry, Cortana, and other Windows behaviors. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.",
    "displayName": "Windows machines should meet requirements for 'Windows Components'",
    "id": "/providers/Microsoft.Authorization/policyDefinitions/8537fe96-8cbe-43de-b0ef-131bc72bc22a",
    "metadata": {
        "category": "Guest Configuration",
        "guestConfiguration": {
            "configurationParameter": {
                "AllowIndexingOfEncryptedFiles": "Allow indexing of encrypted files;ExpectedValue",
                "AllowTelemetry": "Allow Telemetry;ExpectedValue",
                "AllowUnencryptedTraffic": "Allow unencrypted traffic;ExpectedValue",
                "AlwaysInstallWithElevatedPrivileges": "Always install with elevated privileges;ExpectedValue",
                "AlwaysPromptForPasswordUponConnection": "Always prompt for password upon connection;ExpectedValue",
                "ApplicationSpecifyTheMaximumLogFileSizeKB": "Application: Specify the maximum log file size (KB);ExpectedValue",
                "AutomaticallySendMemoryDumpsForOSgeneratedErrorReports": "Automatically send memory dumps for OS-generated error reports;ExpectedValue",
                "ConfigureDefaultConsent": "Configure Default consent;ExpectedValue",
                "ConfigureWindowsSmartScreen": "Configure Windows SmartScreen;ExpectedValue",
                "DisallowDigestAuthentication": "Disallow Digest authentication;ExpectedValue",
                "DisallowWinRMFromStoringRunAsCredentials": "Disallow WinRM from storing RunAs credentials;ExpectedValue",
                "DoNotAllowPasswordsToBeSaved": "Do not allow passwords to be saved;ExpectedValue",
                "SecuritySpecifyTheMaximumLogFileSizeKB": "Security: Specify the maximum log file size (KB);ExpectedValue",
                "SendFileSamplesWhenFurtherAnalysisIsRequired": "Send file samples when further analysis is required;ExpectedValue",
                "SetClientConnectionEncryptionLevel": "Set client connection encryption level;ExpectedValue",
                "SetTheDefaultBehaviorForAutoRun": "Set the default behavior for AutoRun;ExpectedValue",
                "SetupSpecifyTheMaximumLogFileSizeKB": "Setup: Specify the maximum log file size (KB);ExpectedValue",
                "SpecifyTheIntervalToCheckForDefinitionUpdates": "Specify the interval to check for definition updates;ExpectedValue",
                "SystemSpecifyTheMaximumLogFileSizeKB": "System: Specify the maximum log file size (KB);ExpectedValue",
                "TurnOffDataExecutionPreventionForExplorer": "Turn off Data Execution Prevention for Explorer;ExpectedValue"
            },
            "name": "AzureBaseline_WindowsComponents",
            "version": "1.*"
        },
        "requiredProviders": [
            "Microsoft.GuestConfiguration"
        ],
        "version": "3.0.0"
    },
    "mode": "Indexed",
    "name": "8537fe96-8cbe-43de-b0ef-131bc72bc22a",
    "parameters": {
        "AllowIndexingOfEncryptedFiles": {
            "allowedValues": null,
            "defaultValue": "0",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether encrypted items are allowed to be indexed.",
                "displayName": "Allow indexing of encrypted files",
                "strongType": null
            },
            "type": "String"
        },
        "AllowTelemetry": {
            "allowedValues": null,
            "defaultValue": "2",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies configuration of the amount of diagnostic and usage data reported to Microsoft. The data is transmitted securely and sensitive data is not sent.",
                "displayName": "Allow Telemetry",
                "strongType": null
            },
            "type": "String"
        },
        "AllowUnencryptedTraffic": {
            "allowedValues": null,
            "defaultValue": "0",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether the Windows Remote Management (WinRM) service sends and receives unencrypted messages over the network.",
                "displayName": "Allow unencrypted traffic",
                "strongType": null
            },
            "type": "String"
        },
        "AlwaysInstallWithElevatedPrivileges": {
            "allowedValues": null,
            "defaultValue": "0",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether Windows Installer should use system permissions when it installs any program on the system.",
                "displayName": "Always install with elevated privileges",
                "strongType": null
            },
            "type": "String"
        },
        "AlwaysPromptForPasswordUponConnection": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether Terminal Services/Remote Desktop Connection always prompts the client computer for a password upon connection.",
                "displayName": "Always prompt for password upon connection",
                "strongType": null
            },
            "type": "String"
        },
        "ApplicationSpecifyTheMaximumLogFileSizeKB": {
            "allowedValues": null,
            "defaultValue": "32768",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies the maximum size for the Application event log in kilobytes.",
                "displayName": "Application: Specify the maximum log file size (KB)",
                "strongType": null
            },
            "type": "String"
        },
        "AutomaticallySendMemoryDumpsForOSgeneratedErrorReports": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies if memory dumps in support of OS-generated error reports can be sent to Microsoft automatically.",
                "displayName": "Automatically send memory dumps for OS-generated error reports",
                "strongType": null
            },
            "type": "String"
        },
        "ConfigureDefaultConsent": {
            "allowedValues": null,
            "defaultValue": "4",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies setting of the default consent handling for error reports sent to Microsoft.",
                "displayName": "Configure Default consent",
                "strongType": null
            },
            "type": "String"
        },
        "ConfigureWindowsSmartScreen": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies how to manage the behavior of Windows SmartScreen. Windows SmartScreen helps keep PCs safer by warning users before running unrecognized programs downloaded from the Internet. Some information is sent to Microsoft about files and programs run on PCs with this feature enabled.",
                "displayName": "Configure Windows SmartScreen",
                "strongType": null
            },
            "type": "String"
        },
        "DisallowDigestAuthentication": {
            "allowedValues": null,
            "defaultValue": "0",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether the Windows Remote Management (WinRM) client will not use Digest authentication.",
                "displayName": "Disallow Digest authentication",
                "strongType": null
            },
            "type": "String"
        },
        "DisallowWinRMFromStoringRunAsCredentials": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether the Windows Remote Management (WinRM) service will not allow RunAs credentials to be stored for any plug-ins.",
                "displayName": "Disallow WinRM from storing RunAs credentials",
                "strongType": null
            },
            "type": "String"
        },
        "DoNotAllowPasswordsToBeSaved": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether to prevent Remote Desktop Services - Terminal Services clients from saving passwords on a computer.",
                "displayName": "Do not allow passwords to be saved",
                "strongType": null
            },
            "type": "String"
        },
        "IncludeArcMachines": {
            "allowedValues": [
                "true",
                "false"
            ],
            "defaultValue": "false",
            "metadata": {
                "assignPermissions": null,
                "description": "By selecting this option, you agree to be charged monthly per Arc connected machine.",
                "displayName": "Include Arc connected servers",
                "portalReview": "true",
                "strongType": null
            },
            "type": "String"
        },
        "SecuritySpecifyTheMaximumLogFileSizeKB": {
            "allowedValues": null,
            "defaultValue": "196608",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies the maximum size for the Security event log in kilobytes.",
                "displayName": "Security: Specify the maximum log file size (KB)",
                "strongType": null
            },
            "type": "String"
        },
        "SendFileSamplesWhenFurtherAnalysisIsRequired": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether and how Windows Defender will submit samples of suspected malware  to Microsoft for further analysis when opt-in for MAPS telemetry is set.",
                "displayName": "Send file samples when further analysis is required",
                "strongType": null
            },
            "type": "String"
        },
        "SetClientConnectionEncryptionLevel": {
            "allowedValues": null,
            "defaultValue": "3",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether to require the use of a specific encryption level to secure communications between client computers and RD Session Host servers during Remote Desktop Protocol (RDP) connections. This policy only applies when you are using native RDP encryption.",
                "displayName": "Set client connection encryption level",
                "strongType": null
            },
            "type": "String"
        },
        "SetTheDefaultBehaviorForAutoRun": {
            "allowedValues": null,
            "defaultValue": "1",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies the default behavior for Autorun commands. Autorun commands are generally stored in autorun.inf files. They often launch the installation program or other routines.",
                "displayName": "Set the default behavior for AutoRun",
                "strongType": null
            },
            "type": "String"
        },
        "SetupSpecifyTheMaximumLogFileSizeKB": {
            "allowedValues": null,
            "defaultValue": "32768",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies the maximum size for the Setup event log in kilobytes.",
                "displayName": "Setup: Specify the maximum log file size (KB)",
                "strongType": null
            },
            "type": "String"
        },
        "SpecifyTheIntervalToCheckForDefinitionUpdates": {
            "allowedValues": null,
            "defaultValue": "8",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies an interval at which to check for Windows Defender definition updates. The time value is represented as the number of hours between update checks.",
                "displayName": "Specify the interval to check for definition updates",
                "strongType": null
            },
            "type": "String"
        },
        "SystemSpecifyTheMaximumLogFileSizeKB": {
            "allowedValues": null,
            "defaultValue": "32768",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies the maximum size for the System event log in kilobytes.",
                "displayName": "System: Specify the maximum log file size (KB)",
                "strongType": null
            },
            "type": "String"
        },
        "TurnOffDataExecutionPreventionForExplorer": {
            "allowedValues": null,
            "defaultValue": "0",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Specifies whether to turn off Data Execution Prevention for Windows File Explorer. Disabling data execution prevention can allow certain legacy plug-in applications to function without terminating Explorer.",
                "displayName": "Turn off Data Execution Prevention for Explorer",
                "strongType": null
            },
            "type": "String"
        },
        "effect": {
            "allowedValues": [
                "AuditIfNotExists",
                "Disabled"
            ],
            "defaultValue": "AuditIfNotExists",
            "metadata": {
                "additionalProperties": null,
                "assignPermissions": null,
                "description": "Enable or disable the execution of this policy",
                "displayName": "Effect",
                "strongType": null
            },
            "type": "String"
        }
    },
    "policyRule": {
        "if": {
            "anyOf": [
                {
                    "allOf": [
                        {
                            "equals": "Microsoft.Compute/virtualMachines",
                            "field": "type"
                        },
                        {
                            "anyOf": [
                                {
                                    "field": "Microsoft.Compute/imagePublisher",
                                    "in": [
                                        "esri",
                                        "incredibuild",
                                        "MicrosoftDynamicsAX",
                                        "MicrosoftSharepoint",
                                        "MicrosoftVisualStudio",
                                        "MicrosoftWindowsDesktop",
                                        "MicrosoftWindowsServerHPCPack"
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "MicrosoftWindowsServer",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageSKU",
                                            "notLike": "2008*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "MicrosoftSQLServer",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "notLike": "SQL2008*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "microsoft-dsvm",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "like": "dsvm-win*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "microsoft-ads",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "in": [
                                                "standard-data-science-vm",
                                                "windows-data-science-vm"
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "batch",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "equals": "rendering-windows2016",
                                            "field": "Microsoft.Compute/imageOffer"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "center-for-internet-security-inc",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "like": "cis-windows-server-201*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "pivotal",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "like": "bosh-windows-server*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "cloud-infrastructure-services",
                                            "field": "Microsoft.Compute/imagePublisher"
                                        },
                                        {
                                            "field": "Microsoft.Compute/imageOffer",
                                            "like": "ad*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "anyOf": [
                                                {
                                                    "exists": "true",
                                                    "field": "Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration"
                                                },
                                                {
                                                    "field": "Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType",
                                                    "like": "Windows*"
                                                }
                                            ]
                                        },
                                        {
                                            "anyOf": [
                                                {
                                                    "exists": "false",
                                                    "field": "Microsoft.Compute/imageSKU"
                                                },
                                                {
                                                    "allOf": [
                                                        {
                                                            "field": "Microsoft.Compute/imageSKU",
                                                            "notLike": "2008*"
                                                        },
                                                        {
                                                            "field": "Microsoft.Compute/imageOffer",
                                                            "notLike": "SQL2008*"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "allOf": [
                        {
                            "equals": "true",
                            "value": "[parameters('IncludeArcMachines')]"
                        },
                        {
                            "anyOf": [
                                {
                                    "allOf": [
                                        {
                                            "equals": "Microsoft.HybridCompute/machines",
                                            "field": "type"
                                        },
                                        {
                                            "field": "Microsoft.HybridCompute/imageOffer",
                                            "like": "windows*"
                                        }
                                    ]
                                },
                                {
                                    "allOf": [
                                        {
                                            "equals": "Microsoft.ConnectedVMwarevSphere/virtualMachines",
                                            "field": "type"
                                        },
                                        {
                                            "field": "Microsoft.ConnectedVMwarevSphere/virtualMachines/osProfile.osType",
                                            "like": "windows*"
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        "then": {
            "details": {
                "existenceCondition": {
                    "allOf": [
                        {
                            "equals": "Compliant",
                            "field": "Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus"
                        },
                        {
                            "equals": "[base64(concat('Send file samples when further analysis is required;ExpectedValue', '=', parameters('SendFileSamplesWhenFurtherAnalysisIsRequired'), ',', 'Allow indexing of encrypted files;ExpectedValue', '=', parameters('AllowIndexingOfEncryptedFiles'), ',', 'Allow Telemetry;ExpectedValue', '=', parameters('AllowTelemetry'), ',', 'Allow unencrypted traffic;ExpectedValue', '=', parameters('AllowUnencryptedTraffic'), ',', 'Always install with elevated privileges;ExpectedValue', '=', parameters('AlwaysInstallWithElevatedPrivileges'), ',', 'Always prompt for password upon connection;ExpectedValue', '=', parameters('AlwaysPromptForPasswordUponConnection'), ',', 'Application: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('ApplicationSpecifyTheMaximumLogFileSizeKB'), ',', 'Automatically send memory dumps for OS-generated error reports;ExpectedValue', '=', parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports'), ',', 'Configure Default consent;ExpectedValue', '=', parameters('ConfigureDefaultConsent'), ',', 'Configure Windows SmartScreen;ExpectedValue', '=', parameters('ConfigureWindowsSmartScreen'), ',', 'Disallow Digest authentication;ExpectedValue', '=', parameters('DisallowDigestAuthentication'), ',', 'Disallow WinRM from storing RunAs credentials;ExpectedValue', '=', parameters('DisallowWinRMFromStoringRunAsCredentials'), ',', 'Do not allow passwords to be saved;ExpectedValue', '=', parameters('DoNotAllowPasswordsToBeSaved'), ',', 'Security: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SecuritySpecifyTheMaximumLogFileSizeKB'), ',', 'Set client connection encryption level;ExpectedValue', '=', parameters('SetClientConnectionEncryptionLevel'), ',', 'Set the default behavior for AutoRun;ExpectedValue', '=', parameters('SetTheDefaultBehaviorForAutoRun'), ',', 'Setup: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SetupSpecifyTheMaximumLogFileSizeKB'), ',', 'System: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SystemSpecifyTheMaximumLogFileSizeKB'), ',', 'Turn off Data Execution Prevention for Explorer;ExpectedValue', '=', parameters('TurnOffDataExecutionPreventionForExplorer'), ',', 'Specify the interval to check for definition updates;ExpectedValue', '=', parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')))]",
                            "field": "Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash"
                        }
                    ]
                },
                "name": "AzureBaseline_WindowsComponents",
                "type": "Microsoft.GuestConfiguration/guestConfigurationAssignments"
            },
            "effect": "[parameters('effect')]"
        }
    },
    "policyType": "BuiltIn",
    "systemData": null,
    "type": "Microsoft.Authorization/policyDefinitions"
}